# React 事件系统

React 事件系统参考 DOM 事件流当中，利用事件冒泡的特性实现的**事件委托**；       
`document` 上绑定**统一的事件处理程序**，然后**分发到具体的组件实例**；

分发之前，React 对事件进行包装，原生 DOM 事件包装成 **合成事件**

React 合成事件：
  React 自定义的事件对象，底层抹平了不同*浏览器的差异*，上层暴露`统一的、稳定的、与原生 DOM 事件相同的事件接口`

虽然合成事件不是原生 DOM 事件，但保存了原生 DOM 事件的引用，可以通过 `e.nativeEvent` 获取原生事件


## 事件系统的工作流
> 事件绑定 + 事件触发

1. 事件绑定
在挂载过程中(`completeWork`)完成:
    - 创建 DOM 节点
    - 将 DOM 节点插入 DOM 树
    - 为 DOM 节点设置属性
      - 遍历 fiberNode 的 props key，当遍历到事件相关的 props 时触发事件的注册链路

React 最终注册到 document 上的不是每个节点的对应回调，而是一个**统一的事件分发函数** `dispatchEvent`

2. 事件的触发
本质是对 `dispatchEvent` 函数的调用
    - 事件触发，冒泡至 document
    - 执行 dispatchEvent
    - 创建对应的*合成事件对象*
    - 收集事件在`捕获阶段`涉及的 **回调函数和对应的节点实例**
    - 收集`冒泡阶段`的 **回调函数和节点实例**
    - 将前两步收集的回调按顺序执行，*合成事件对象*作为入参传入每个回调

实际上是基于 **合成事件在模拟事件流**

相较于原生 DOM 事件流，React 自己的事件系统更加符合 React 框架及场景，在很大程度上干预事件的表现，使其符合自身的需求

对 React 来说，沿袭事件委托帮助 React 实现了对所有事件的中心化管控

性能方面并非主要原因